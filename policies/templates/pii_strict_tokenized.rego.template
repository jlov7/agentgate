package agentgate

import future.keywords.if
import future.keywords.in

default decision := {"action": "DENY", "reason": "No matching rule"}

decision := {
	"action": "DENY",
	"reason": "PII content requires tokenization",
	"matched_rule": "pii_tokenization_required",
} if {
	input.contains_pii
	not input.pii_tokenized
}

decision := {
	"action": "ALLOW",
	"reason": "Read-only tool",
	"matched_rule": "read_only_tools",
	"allowed_scope": "read",
	"is_write_action": false,
} if {
	input.tool_name in data.read_only_tools
}

decision := {
	"action": "REQUIRE_APPROVAL",
	"reason": "Write action requires human approval",
	"matched_rule": "write_requires_approval",
	"is_write_action": true,
} if {
	input.tool_name in data.write_tools
	not input.has_approval_token
}

decision := {
	"action": "ALLOW",
	"reason": "Write action approved and tokenized",
	"matched_rule": "write_with_approval_tokenized",
	"allowed_scope": "write",
	"is_write_action": true,
} if {
	input.tool_name in data.write_tools
	input.has_approval_token
	not input.contains_pii
}

decision := {
	"action": "ALLOW",
	"reason": "Write action approved for tokenized PII request",
	"matched_rule": "write_with_approval_tokenized_pii",
	"allowed_scope": "write",
	"is_write_action": true,
} if {
	input.tool_name in data.write_tools
	input.has_approval_token
	input.contains_pii
	input.pii_tokenized
}
